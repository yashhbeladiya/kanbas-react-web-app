YUI.add("hermes-template-fluid-share-old-html-embed-code",(function(l,e){var a=l.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(l,e,a,n,t){var i,o=null!=e?e:l.nullContext||{},r=l.hooks.helperMissing,m="function",u=l.escapeExpression,c=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return'<a href="'+u(typeof(i=null!=(i=c(a,"embedLink")||(null!=e?c(e,"embedLink"):e))?i:r)===m?i.call(o,{name:"embedLink",hash:{},data:t,loc:{start:{line:1,column:9},end:{line:1,column:22}}}):i)+'" title="'+u(typeof(i=null!=(i=c(a,"title")||(null!=e?c(e,"title"):e))?i:r)===m?i.call(o,{name:"title",hash:{},data:t,loc:{start:{line:1,column:31},end:{line:1,column:40}}}):i)+" by "+u(typeof(i=null!=(i=c(a,"authorName")||(null!=e?c(e,"authorName"):e))?i:r)===m?i.call(o,{name:"authorName",hash:{},data:t,loc:{start:{line:1,column:44},end:{line:1,column:58}}}):i)+", "+u((c(a,"intlMessage")||e&&c(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"share-modal.ON_FLICKR"},data:t,loc:{start:{line:1,column:60},end:{line:1,column:108}}}))+'"><img src="'+u(typeof(i=null!=(i=c(a,"farmURL")||(null!=e?c(e,"farmURL"):e))?i:r)===m?i.call(o,{name:"farmURL",hash:{},data:t,loc:{start:{line:1,column:120},end:{line:1,column:131}}}):i)+'" width="'+u(typeof(i=null!=(i=c(a,"width")||(null!=e?c(e,"width"):e))?i:r)===m?i.call(o,{name:"width",hash:{},data:t,loc:{start:{line:1,column:140},end:{line:1,column:149}}}):i)+'" height="'+u(typeof(i=null!=(i=c(a,"height")||(null!=e?c(e,"height"):e))?i:r)===m?i.call(o,{name:"height",hash:{},data:t,loc:{start:{line:1,column:159},end:{line:1,column:169}}}):i)+'" alt="'+u(typeof(i=null!=(i=c(a,"alt")||(null!=e?c(e,"alt"):e))?i:r)===m?i.call(o,{name:"alt",hash:{},data:t,loc:{start:{line:1,column:176},end:{line:1,column:183}}}):i)+'"></a>'},useData:!0}),n={};l.Array.each([],(function(e){var a=l.Template.get("hermes/"+e);a&&(n[e]=a)})),l.Template.register("hermes/fluid-share-old-html-embed-code",(function(e,t){return(t=t||{}).partials=t.partials?l.merge(n,t.partials):n,a(e,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-fluid-share-old-iframe-embed-code",(function(e,l){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,l,a,n,r){var t,i=null!=l?l:e.nullContext||{},o=e.hooks.helperMissing,s="function",u=e.escapeExpression,m=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<iframe src="'+u(typeof(t=null!=(t=m(a,"embedLink")||(null!=l?m(l,"embedLink"):l))?t:o)===s?t.call(i,{name:"embedLink",hash:{},data:r,loc:{start:{line:1,column:13},end:{line:1,column:26}}}):t)+'" width="'+u(typeof(t=null!=(t=m(a,"width")||(null!=l?m(l,"width"):l))?t:o)===s?t.call(i,{name:"width",hash:{},data:r,loc:{start:{line:1,column:35},end:{line:1,column:44}}}):t)+'" height="'+u(typeof(t=null!=(t=m(a,"height")||(null!=l?m(l,"height"):l))?t:o)===s?t.call(i,{name:"height",hash:{},data:r,loc:{start:{line:1,column:54},end:{line:1,column:64}}}):t)+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>'},useData:!0}),n={};e.Array.each([],(function(l){var a=e.Template.get("hermes/"+l);a&&(n[l]=a)})),e.Template.register("hermes/fluid-share-old-iframe-embed-code",(function(l,r){return(r=r||{}).partials=r.partials?e.merge(n,r.partials):n,a(l,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-contacts-getListfetcher",(function(e,t){"use strict";e.namespace("ListFetchers")["flickr-contacts-getList"]={run:function(r,s){var c=this;return r.extras=(r.extras||"")+", icon_urls, paid_products",e.Promise.all([s.callAPI("flickr.contacts.getList",r),s.getModelRegistry("person-models")]).then((function(e){return c._processResponse(e,r)}),e.FetcherErrorLogger(t))},_processResponse:function(t,r){var s=t[0],c=t[1];return s.contacts&&s.contacts.contact&&s.contacts.contact.forEach((function(t){c.addOrUpdate(e.APIHelper.response.parsePerson(t))})),s}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-models"]});YUI.add("contact-search-box",(function(t){var e,i=function(i){this.options=i,this.options.elValue=this.options.elValue||"value",this.options.hideInitially,this._contacts=null,this.queryEl=this.options.el,this.queryElEvent,this.listEl=null,e=this.options.DOMContainer||t.config.win,this.init()};i.prototype={langBundles:this.details.langBundles,init:function(){var e=this;if(!1!==this.options.showFollowingState&&(this.options.showFollowingState=!0),!this.queryEl)throw new Error("Need this.queryEl.");this.queryEl.on("keydown",this.keynav.bind(this)),this.queryElEvent=this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=t.Node.create("<div/>"),this.wrapperEl.addClass("c-contact-search-autocomplete"),this.listEl=t.Node.create("<ul/>"),this.listEl.addClass("contact-list"),this.wrapperEl.appendChild(this.listEl),this.listEl.on("mouseover",(function(t){var i=t.target.ancestor("li",!0);i&&i!==e.highlighted&&e._highlight(i)})),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.options.clickContact=this.options.clickContact||function(t){var i=t.target.ancestor("[data-nsid]",!0),s=i?i.getData("nsid"):"";e.select(s)},this.listEl.delegate("click",this.options.clickContact,"li"),this.selectedIndex=0},keynav:function(t){38===t.keyCode?(t.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.numShowing+this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):40===t.keyCode?(t.preventDefault(),this.selectedIndex++,this.selectedIndex>this.numShowing-1&&(this.selectedIndex=this.numShowing-this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):9===t.keyCode?this._visible&&this.highlighted&&(t.preventDefault(),this.select(this.highlighted.getData("nsid"))):13===t.keyCode&&this._visible&&this.highlighted&&(t.preventDefault(),t.target.ancestor(".share-view",!0)||t.target.ancestor(".fluid-share-panel-view",!0)?this.select(this.highlighted.getData("nsid")):this.options.clickContact(t,this.highlighted))},_highlight:function(e){var i=this.listEl.all("li"),s=e instanceof t.Node,n=s?e:i.item(e),o=s?i.indexOf(e):e;!n||n.hasClass("loading")||n.hasClass("no-members")||(i.removeClass("highlight"),n.addClass("highlight"),this.selectedIndex=o,this.highlighted=n)},_scrollToNode:function(t){var e=this.listEl.get("scrollTop"),i=e+this.listEl.get("clientHeight"),s=t.get("offsetTop"),n=s+t.get("clientHeight");e>s?this.listEl.set("scrollTop",s-5):i<n&&this.listEl.set("scrollTop",n-this.listEl.get("clientHeight")+5)},getContact:function(t){for(var e=0,i=this._contacts,s=i.length;e<s;e++)if(i[e].nsid===t&&!i[e].hide)return i[e]},hideFromSearch:function(t){t=t.trim(),this._contacts&&this._contacts.some((function(e){if(e.nsid.trim()===t)return e.hide=!0,!0}))},resetSearch:function(){this._contacts&&this._contacts.forEach((function(t){t.hide=!1}))},showInSearch:function(t){t=t.trim(),this._contacts&&this._contacts.some((function(e){if(e.nsid.trim()===t)return e.hide=!1,!0}))},load:function(t){var e,i={},s=this;if(!this._busy)return this._end=!1,this._busy=!0,i.can_tag=this.options.canTag||0,e=this.options.appContext.getViewer().nsid,this.options.appContext.getModel("contacts-models",e).then((function(e){return i.page=1,i.perPage=3e3,i.per_page=3e3,s._loadMoreContacts(e,i,t)}),(function(){s._busy=!1,s.options.onError()}))},_loadMoreContacts:function(t,e,i){var s=this;return this._busy=!0,s.options.loadingState&&!s.listEl.one("li.loading")&&s.appendLoader(),t.getValue("contacts").getPage(e).then((function(n){s._contacts=(s.processContactModels(n,!0,!0)||[]).concat(s._contacts||[]),i(),s._contacts&&0!==s._contacts.length||s.hide(),e.page<t.getValue("pages")&&(e.page++,s._loadMoreContacts(t,e,i))}),(function(){s._busy=!1,s.options.onError()}))},processContactModels:function(e,i,s){var n,o,l,h=this;try{l=e.map((function(t){return t.toJSON()}))||[]}catch(t){l=[]}if(!h.contactIds&&(h.contactIds={},h._contacts))for(o in h._contacts)h.contactIds[o.id]=!0;return(l=l.filter((function(t){return!h.contactIds[t.id]}))).forEach((function(e,i){h.contactIds[e.id]=!0,e.realname=e.realname||e.username,e.isContact=s,e.buddyicon=t.URLHelper.getBuddyIconURL(e.nsid,e.iconfarm,e.iconserver)})),i&&h.options.me&&(n=h.options.me.toJSON(),t.APIHelper.response.removeProtocolFromURL(n.buddyicon),n.buddyicon=n.buddyicon.default,h.contactIds[n.id]=!0,n.me=!0,l.push(n)),h.options.hideInitially&&l.forEach((function(t){h.options.hideInitially.indexOf(t.nsid)>-1&&(t.hide=!0)})),l},destructor:function(){this.queryElEvent&&this.queryElEvent.detach&&this.queryElEvent.detach()},hide:function(t){t&&t.halt(),this._visible&&(this._visible=!1,this.highlighted=null,this.selectedIndex=0,this.selected=null,this.options.noShim||this._shimUp(!1),this.listEl.setStyle("display","none"),this.options.onHide&&this.options.onHide())},show:function(){this._visible||(this._visible=!0,this.options.noShim||this._shimUp(),this.listEl.setStyle("display","block"),this._reposition(),this.options.onShow())},_reposition:function(){e.innerWidth||e.clientWidth;var i,s=e.innerHeight||e.clientHeight,n=this.options.el,o=n.getDOMNode(),l=o.getBoundingClientRect(),h=this.listEl.getDOMNode().getBoundingClientRect(),a=!this._contacts&&this.options.upInitially,c=e===t.config.win?l.top:o.clientTop;this.options.dialogOffset&&(i=this.options.dialogOffset()),a||c>0&&c+h.height+25>s&&!this.options.alwaysDownward?(this.listEl.setStyle("top","auto"),this.listEl.setStyle("bottom","25px"),this.options.onOrientationChange&&this.options.onOrientationChange(!0)):(this.listEl.setStyle("top",i||null),this.listEl.setStyle("bottom",null),this.options.onOrientationChange&&this.options.onOrientationChange(!1),n.ancestor(".modal",!0)&&this.listEl.setStyle("maxHeight",s-c-25))},_shimUp:function(e){if(!1===e){if(!this._shim)return;return this._shim.detach("click").remove(),void(this._shim=null)}this._shim=t.Node.create("<div/>"),this._shim.addClass(this.options.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild(this._shim)},select:function(t){"string"==typeof t&&(t=this.getContact(t))&&this.queryEl.set("value",t.realname),t&&(this.selected=t,this.options.onSelect(t)),this.hide()},search:function(t){var e,i,s=this.queryEl.get(this.options.elValue),n=this,o=this.options.appContext.getViewer().nsid;if(t&&27===t.keyCode)return t.preventDefault(),void this.queryEl.blur();if(t&&-1!==[38,40,9].indexOf(t.keyCode))t.preventDefault();else{if(this._nameTest(s),this.selected=null,this.selectedIndex=0,this.abort=!1,""===s.trim())return this.abort=!0,this.hide();if(this.options.searchNonContacts||(this._end=!0,this._busy=!1),this._contacts&&this.options.me&&"me"===s)return this.showResults(this._contacts.filter((function(t){return!t.hide&&t.me})).concat(this._contacts.filter((function(t){return!t.hide&&n._matchesQuery(t)}))));if(this._isEmail(s))return this.select({email:s,nsid:null});if(/,/.test(s))return this.select(null);if(!this._contacts){if(this.options.signedOut)return;this.showResults(),this.load(this.search.bind(this))}this._contacts&&(e=this._contacts.filter((function(t){return!t.hide&&n._matchesQuery(t)}))),this.showResults(e),n.listEl.getDOMNode(),this.options.searchNonContacts&&(this.options.loadMoreOnScroll&&s.length>0?(i=1,clearTimeout(this.searchAllPeople),this.searchInstanceId=999999*Math.random(),this.searchAllPeople=setTimeout((function(){n._searchPeople(s,o,i,n.searchInstanceId,(function(){n._busy=!1,n.showResults(n._contacts.filter((function(t){return!t.hide&&n._matchesQuery(t)}))),n.listElScrollEvent=n.listEl.on("scroll",(function(){n.listEl._node.clientHeight+n.listEl._node.scrollTop===n.listEl._node.scrollHeight&&(i++,n._loadMore(i,o,s))}))}))}),500)):(clearTimeout(this.searchAllPeople),this.searchInstanceId=999999*Math.random()))}},_loadMore:function(t,e,i){var s=this;this._busy=!0,clearTimeout(this.searchAllPeople),this.searchInstanceId=999999*Math.random(),this.searchAllPeople=setTimeout((function(){s.options.loadingState&&!s.listEl.one("li.loading")&&s.appendLoader(),s._searchPeople(i,e,t,s.searchInstanceId,(function(){s.showResults(s._contacts.filter((function(t){return!t.hide&&s._matchesQuery(t)}))),s.listElScrollEvent&&s.listElScrollEvent.detach(),s.listElScrollEvent=s.listEl.on("scroll",(function(){s.listEl._node.clientHeight+s.listEl._node.scrollTop===s.listEl._node.scrollHeight&&(t++,s._loadMore(t,e,i))}))}))}),100)},_nameTest:function(e){var i=new RegExp(".*"+t.flutil.agnosticizeUnicode(e).replace(/\s/,"\\s")+".*","ig");this._matchesQuery=function(t){return i.test(t.username)||i.test(t.realname)||i.test(t.email)}},appendLoader:function(t){t=t||this.listEl;var e=document.createElement("li"),i=t.scrollTop;e.className="loading",e.innerHTML=this.options.loadingState,t.appendChild(e),t.scrollTop=i+e.clientHeight},_searchPeople:function(t,e,i,s,n){var o=this;o._end=!1,o.options.loadingState&&!o.listEl.one("li.loading")&&o.appendLoader(),o.options.appContext.getModel("contacts-models",e).then((function(e){return e.search({username:t,page:i}).then((function(t){var e=t.people,i=o.processContactModels(e,!1,!1);o._contacts=o._contacts||[],o._contacts=o._contacts.concat(i),o._contacts.some((function(t){return o._matchesQuery(t)}))||(o._end=!0),n()}),(function(){o._end=!0,o._busy=!1,n()}))}),(function(){o._end=!0,o._busy=!1,n()}))},_isEmail:function(t,e){t=/,/.test(t)?t.split(/,/):[t];var i=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(e){for(;t.length;)if(i.test(t.shift().trim()))return!0;return!1}for(;t.length;)if(!i.test(t.shift().trim()))return!1;return!0},showResults:function(e){if(!this.abort){var i,s,n=this.options.max||10,o=this;i=document.createDocumentFragment(),e&&this.selectedIndex>=e.length&&(this.selectedIndex=e.length-1),this.numShowing=Math.min(n,e&&e.length||0),!o._busy&&e&&0===e.length?((s=document.createElement("li")).innerHTML='<span class="no-contacts">'+this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"})+"</span>",s.className="no-members",i.appendChild(s),o.highlighted=null):e&&e.slice(0,n).forEach((function(e,s,n){var l=o.createItem(e);s===o.selectedIndex&&(l.setAttribute("class","highlight"),o.highlighted=t.Node(l)),i.appendChild(l)})),!o._busy&&e||!o.options.loadingState||o.appendLoader(i),this.options.loadMoreOnScroll&&this.listElScrollEvent&&this.listElScrollEvent.detach(),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(i),this.show()}},_template:function(){return['<img src="{{buddyicon}}">','<div class="following-status {{isContact}}">','<span class="following-icon">&nbsp;</span>',"<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>","</div>",'<h2 class="all">{{realname}}</h2>','<h3 class="all">{{username}}</h3>'].join("")},_onlyContactTemplate:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(e){var i,s=document.createElement("li"),n=this.options.searchNonContacts&&this.options.showFollowingState?this._template():this._onlyContactTemplate,o=this.options.truncateLength||70;return i=n.replace(/\{\{(\w+)\}\}/g,(function(i,s){if("buddyicon"===s)return e[s];if("isContact"===s)return e[s]?"am-following":"";var n=t.flutil.escapeInput(e[s]);return t.Handlebars.helpers.truncate(n,o)})),s.innerHTML=i,s.dataset?(s.dataset=s.dataset,s.dataset.nsid=e.nsid,s.dataset.displayname=e.realname||e.username,s.dataset.pathAlias=e.pathAlias,s.dataset.ispro=e.isPro,s.dataset.probadge=e.proBadge):(s.setAttribute("data-nsid",e.nsid),s.setAttribute("data-displayname",e.realname||e.username),s.setAttribute("data-path-alias",e.pathAlias),s.setAttribute("data-ispro",e.isPro),s.setAttribute("data-probadge",e.proBadge)),s}},t.mix(i.prototype,t.Localizable),t.ContactSearchBox=i}),"@VERSION@",{requires:["api-helper","flutil","handlebars-helpers","flickr-contacts-getListfetcher"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-html5-balls",(function(e,a){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,l,t,r){return'\n<div class="html5-balls">\n\t<div class="blueball"></div>\n\t<div class="pinkball"></div>\n</div>\n'},useData:!0}),t={};e.Array.each([],(function(a){var l=e.Template.get("hermes/"+a);l&&(t[a]=l)})),e.Template.register("hermes/html5-balls",(function(a,r){return(r=r||{}).partials=r.partials?e.merge(t,r.partials):t,l(a,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-html4-balls",(function(e,a){var r=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,r,t,l){return'\n<div class="html4-balls"></div>\n'},useData:!0}),t={};e.Array.each([],(function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)})),e.Template.register("hermes/html4-balls",(function(a,l){return(l=l||{}).partials=l.partials?e.merge(t,l.partials):t,r(a,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("html5-balls",(function(e){var l,t=!(e.UA.ie&&e.UA.ie<9);l=function(e){return t?"html5-balls":"html4-balls"},e.augment(l,e.Attribute),e.Balls=l}),"@VERSION@",{requires:["base","hermes-template-html5-balls","hermes-template-html4-balls","handlebars-helpers","template-base"]});